/*! frontend 2021-09-17 */

(async()=>{for(var e=document.getElementsByClassName("collapsible"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){this.classList.toggle("active");var e=this.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"});$("#logoBtn").click(function(){window.location.href="index.html"}),$("#animalsBtn").click(function(){window.location.href="index.html",console.log("On inddex.html")}),$("#whoBtn").click(function(){window.location.href="about.html"}),$("#listingBtn").click(function(){window.location.href="listing.html"}),$("#user").click(function(){$("#headerPopover").fadeIn("slow"),$("#loginContent").css("display","flex"),$("#loginContent").hide(),$("#loginContent").fadeIn("slow"),$("#emptyCartContent").css("display","none"),$("#fullCartContent").css("display","none"),$("#createAccountContent").css("display","none")}),$("#createAccountBtn").click(function(){$("#createAccountContent").css("display","flex"),$("#createAccountContent").hide(),$("#createAccountContent").fadeIn("slow"),$("#loginContent").css("display","none")}),$("#signUpBtn").click(function(){$("#loginContent").css("display","flex"),$("#loginContent").hide(),$("#loginContent").fadeIn("slow"),$("#createAccountContent").css("display","none")}),$("#cart").click(function(){$("#headerPopover").fadeIn("slow"),$("#emptyCartContent").css("display","flex"),$("#emptyCartContent").hide(),$("#emptyCartContent").fadeIn("slow"),$("#loginContent").css("display","none"),$("#createAccountContent").css("display","none")}),$("#popoverExit").click(function(){$("#headerPopover").fadeOut("slow"),$("#loginContent").fadeOut("slow"),$("#emptyCartContent").fadeOut("slow"),$("#fullCartContent").css("display","none"),$("#createAccountContent").fadeOut("slow")}),$("#popoverExit").click(function(){$("#headerPopover").fadeOut("slow"),$("#loginContent").css("display","none"),$("#cartContent").css("display","none")}),$("#exploreBtn").click(function(){$([document.documentElement,document.body]).animate({scrollTop:$("#listingSection").offset().top},1500)}),$("#askQuestionBtn").click(function(){$("#askQuestionForm").css("display","flex"),$("#askQuestionForm").hide(),$("#askQuestionForm").show("slow")}),$("#sendBtn").click(function(){var e=document.querySelector("#questionInput").value;console.log(e),$("#askQuestionForm").hide("slow")}),$("#questionExitBtn").click(function(){$("#askQuestionForm").hide("slow")}),window.loggedIn=!1,window.alreadyStored=!1,window.currentSession="",window.pricesSorted=[],window.ratingsSorted=[],window.defaultSorted=[];let o=()=>{window.currentSession,window.sessionHeader=document.querySelector("#sessionHeader")||"",window.loginPopOver=document.querySelector(".header-popover")||"",window.allPrices=document.querySelectorAll(".price")||"",window.titles=document.querySelectorAll(".title")||"",window.fileInput=document.querySelector(".ignore-me")||"",window.usernameInput=document.querySelector("#username")||"",window.passwordInput=document.querySelector("#password")||"",window.searchInput=document.querySelector("#searchInput")||"",window.filterInput=document.querySelector("#filterInput")||"",window.typeInput=document.querySelector("#typeInput")||"",window.usernameCreate=document.querySelector("#usernameCreate")||"",window.passwordCreate=document.querySelector("#passwordCreate")||"",window.allFilterInputs=document.querySelectorAll(".select")||"",window.signUpButton=document.querySelector("#signUpBtn")||"",window.loginButton=document.querySelector("#submitLogin")||"",window.createAccountButton=document.querySelector("#createAccountBtn")||"",window.searchButton=document.querySelector("#searchButton")||"",window.closeLoginButton=document.querySelector(".popover-exit-btn")||"",window.listingButton=document.querySelector(".listing-btn")||"",window.cardParent=document.querySelector(".all-listings")||"",window.cards=document.querySelectorAll(".card")||""},n=()=>{loginButton.textContent="Log Out",sessionHeader.textContent=`User: ${localStorage.getItem("currentSession")}`,usernameInput.style.display="none",passwordInput.style.display="none",createAccountButton.style.display="none",loginPopOver.style.height="14%",loginPopOver.style.paddingBottom="30px"},r=()=>{currentSession=null,loggedIn=!0,loginButton.textContent="Log In",sessionHeader.textContent="Log In",usernameInput.style.display="block",passwordInput.style.display="block",createAccountButton.style.display="block",loginPopOver.style.height="50vh",loginPopOver.style.paddingBottom="0"};let a=async(...e)=>{var[t,n]=e;let o=await fetch(`/findUser?u=${t}&p=${n}`);e=await o.json();return o=""!=t&&""!=n,loggedIn&&i(),window.attemptedLogin=t,e},i=async()=>{if(o(),!loggedIn){if(await a(usernameInput.value,passwordInput.value))return n(),currentSession=attemptedLogin,closeLoginButton.click(),console.log("Signing in"),loggedIn=!0,localStorage.setItem("currentSession",currentSession),void localStorage.setItem("loggedIn",loggedIn);alert("Incorrect login!")}loggedIn&&(r(),closeLoginButton.click(),console.log("Signing out"),loggedIn=!1,localStorage.setItem("currentSession",currentSession),localStorage.setItem("loggedIn",loggedIn))};setInterval(function(){o(),"true"===localStorage.getItem("loggedIn")&&n(),"true"===localStorage.getItem("loggedIn")&&(loggedIn=!0),cards.forEach(function(e){e.addEventListener("click",()=>{cardId=e.getAttribute("data-objectid"),localStorage.setItem("cardId",cardId),localStorage.setItem("Checking","Checking"),window.location.href="/animalTemplate.html"})})},500);let l=(...e)=>{var[t,e]=e;o(),"byType"==t&&d(e),"byFilter"==t&&s(e)},c=async e=>{for(title of titles)title.textContent.toLowerCase().includes(e.toLowerCase())?title.parentNode.parentNode.style.display="block":title.parentNode.parentNode.style.display="none"},s=e=>{if(0==alreadyStored){for(var t=0;t<cards.length;t++)defaultSorted.push({element:cards[t]});alreadyStored=!0}switch(e){case"lowest":for(card of cards)pricesSorted.push({price:card.getAttribute("data-price"),element:card}),pricesSorted.sort((e,t)=>e.price-t.price);for(let e=0;e<pricesSorted.length;e++)cardParent.appendChild(pricesSorted[e].element);break;case"highest":for(card of cards)pricesSorted.push({price:card.getAttribute("data-price"),element:card}),pricesSorted.sort((e,t)=>t.price-e.price);for(let e=0;e<pricesSorted.length;e++)cardParent.appendChild(pricesSorted[e].element);break;case"viewed":for(card of cards)ratingsSorted.push({rating:card.getAttribute("data-rating"),element:card}),ratingsSorted.sort((e,t)=>t.rating-e.rating);for(let e=0;e<ratingsSorted.length;e++)cardParent.appendChild(ratingsSorted[e].element);break;case"none":for(let e=0;e<defaultSorted.length;e++)cardParent.appendChild(defaultSorted[e].element)}},d=e=>{for(card of cards){var t=e===card.getAttribute("data-animalType");t||(card.style.display="none"),t&&(card.style.display="block"),"all"===e&&(card.style.display="block")}};(async()=>{let e=await fetch("/findAnimal");var t=await e.json();cardParent.innerHTML="";for(card of t)cardParent.innerHTML+=`
                  <div class="card" data-objectId="${card._id}" data-price="${card.price}" data-rating="${card.rating.charAt(0)}" data-animalType="${card.type}">
                        <div class="top-info">
                            <div class="username">
                                <h5>${card.owner}</h5>
                            </div>
                            <div class="rating">
                                <h5>${card.rating}</h5>
                            </div>
                        </div>
                        <div class="card-img">
                            <button class="favourite" type="button" name="button"> <a class="fa fa-heart" href="#"></a> </button>
                            <img src="${card.url[0]}" alt="">
                        </div>
                        <div class="bottom-info">
                            <div class="title">
                                <h4>${card.name}</h4>
                            </div>
                            <div class="price">
                                <h5>$${card.price.toLocaleString()}</h5>
                                </div>
                            </div>
                    </div>
                `})(),o(),loginButton.addEventListener("click",async()=>{i()}),passwordInput.addEventListener("keydown",e=>{13===e.keyCode&&(e.preventDefault(),loginButton.click())}),signUpButton&&signUpButton.addEventListener("click",async()=>{(async()=>{var e,t;loggedIn||(e=usernameCreate.value,t=passwordCreate.value,await fetch("/createUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:".",username:e,phoneNo:".",email:".",description:".",password:t})}))})()}),(()=>{for(input of allFilterInputs)input.addEventListener("change",()=>{o();var e=""===typeInput.value,t=""===filterInput.value,n=""===searchInput.value;e||l("byType",typeInput.value),t||l("byFilter",filterInput.value),n||c(searchInput.value)});searchInput&&searchInput.addEventListener("keyup",()=>{c(searchInput.value)})})()})();