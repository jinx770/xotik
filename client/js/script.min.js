/*! frontend 2021-09-23 */

let coll=document.getElementsByClassName("collapsible"),i;for(i=0;i<coll.length;i++)coll[i].addEventListener("click",function(){this.classList.toggle("active");let e=this.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"});window.onload=e=>{$("#header").velocity({opacity:"1"},{duration:700,easing:"ease-in",delay:0}),screen.width<778?($("#hero").velocity({top:"500px",opacity:"1"},{duration:2e3,easing:"spring",delay:500}),$("#swipeMessage").velocity({opacity:"1"},{duration:2e3,easing:"easeInOutQuint",delay:2e3}),$("#swipeMessage").velocity({opacity:"1"},{duration:2e3,easing:"easeInOutQuint",delay:2e3}),$("#swipeMessage").velocity({opacity:"0"},{duration:2e3,easing:"easeInOutQuint",delay:2e3})):$("#hero").velocity({top:"200px",opacity:"1"},{duration:2e3,easing:"spring",delay:500})},$("#logoBtn").click(function(){window.location.href="index.html"}),$("#whoBtn").click(function(){window.location.href="about.html"}),$("#listingBtn").click(function(){window.location.href="listing.html"}),$("#mobileWhoBtn").click(function(){window.location.href="about.html"}),$("#mobileEnquireBtn").click(function(){window.location.href="about.html"}),$("#mobileListingBtn").click(function(){window.location.href="listing.html"}),$("#user").click(function(){"true"===localStorage.getItem("loggedIn")?($("#headerPopover").velocity({width:"350px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").velocity({height:"300px",paddingTop:"40px"},{duration:500,easing:"easeInOutQuint",delay:0})):($("#headerPopover").velocity({width:"350px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").velocity({height:"400px",paddingTop:"40px"},{duration:500,easing:"easeInOutQuint",delay:0})),$("#headerPopover").fadeIn("slow"),$("#loginContent").css("display","flex"),$("#loginContent").hide(),$("#loginContent").fadeIn("slow"),$("#emptyCartContent").css("display","none"),$("#fullCartContent").css("display","none"),$("#createAccountContent").css("display","none")}),$("#createAccountBtn").click(function(){$("#createAccountContent").css("display","flex"),$("#createAccountContent").hide(),$("#createAccountContent").fadeIn("slow"),$("#loginContent").css("display","none")}),$("#signUpBtn").click(function(){$("#loginContent").css("display","flex"),$("#loginContent").hide(),$("#loginContent").fadeIn("slow"),$("#createAccountContent").css("display","none")}),$("#cart").click(function(){$("#headerPopover").fadeIn("slow"),"true"==localStorage.getItem("somethingInBasket")?($("#fullCartContent").css("display","flex"),$("#fullCartContent").hide(),$("#fullCartContent").fadeIn("slow"),updateCart(),$("#headerPopover").velocity({width:"350px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").velocity({height:"400px",paddingTop:"40px"},{duration:500,easing:"easeInOutQuint",delay:0})):($("#emptyCartContent").css("display","flex"),$("#emptyCartContent").hide(),$("#emptyCartContent").fadeIn("slow"),$("#headerPopover").velocity({width:"350px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").velocity({height:"200px",paddingTop:"40px"},{duration:500,easing:"easeInOutQuint",delay:0})),$("#loginContent").css("display","none"),$("#createAccountContent").css("display","none")}),$("#popoverExit").click(function(){$("#headerPopover").addClass("checked"),$("#headerPopover").velocity({height:"25px",paddingTop:"10px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").velocity({width:"0px"},{duration:500,easing:"easeInOutQuint",delay:0}),$("#headerPopover").delay(500).fadeOut(500)}),$("#exploreBtn").click(function(){$([document.documentElement,document.body]).animate({scrollTop:$("#listingSection").offset().top},1500)}),$("#askQuestionBtn").click(function(){$("#askQuestionForm").css("display","flex"),$("#askQuestionForm").hide(),$("#askQuestionForm").show("slow")}),$("#sendBtn").click(function(){$("#askQuestionForm").hide("slow")}),$("#questionExitBtn").click(function(){$("#askQuestionForm").hide("slow")}),window.loggedIn=!1,window.alreadyStored=!1,window.cartItems=[],window.pricesSorted=[],window.ratingsSorted=[],window.defaultSorted=[],window.currentSession="",localStorage.getItem("loggedIn")||localStorage.setItem("loggedIn",!1),localStorage.getItem("cartCost")||localStorage.setItem("cartCost",[]);let refreshElements=()=>{window.titles=document.querySelectorAll(".title")||"",window.modalParent=document.querySelector(".modal")||"",window.allPrices=document.querySelectorAll(".price")||"",window.doneButton=document.querySelector(".modalDone")||"",window.sessionHeader=document.querySelector("#sessionHeader")||"",window.loginPopOver=document.querySelector(".header-popover")||"",window.typeInput=document.querySelector("#typeInput")||"",window.fileInput=document.querySelector(".ignore-me")||"",window.usernameInput=document.querySelector("#username")||"",window.passwordInput=document.querySelector("#password")||"",window.searchInput=document.querySelector("#searchInput")||"",window.filterInput=document.querySelector("#filterInput")||"",window.allFilterInputs=document.querySelectorAll(".select")||"",window.usernameCreate=document.querySelector("#usernameCreate")||"",window.passwordCreate=document.querySelector("#passwordCreate")||"",window.signUpButton=document.querySelector("#signUpBtn")||"",window.loginButton=document.querySelector("#submitLogin")||"",window.searchButton=document.querySelector("#searchButton")||"",window.listingButton=document.querySelector(".listing-btn")||"",window.mobileNavLogout=document.querySelector("#submitLogout")||"",window.closeLoginButton=document.querySelector(".popover-exit-btn")||"",window.createAccountButton=document.querySelector("#createAccountBtn")||"",window.userListing=document.querySelectorAll(".user-listing")||"",window.userListingParent=document.querySelector(".user-all-listings")||"",window.cards=document.querySelectorAll(".card")||"",window.cardParent=document.querySelector(".all-listings")||"",window.cartParent=document.querySelector(".cart-item-content")||"",window.total=document.querySelector(".checkout-popover-bottom").childNodes[1]||"",window.cartList=localStorage.getItem("cartItems")?JSON.parse(localStorage.getItem("cartItems")):[]},handleHomeAnimals=async()=>{let e=await fetch("/findAnimal");var t=await e.json();cardParent.innerHTML="";for(card of t)cardParent.innerHTML+=`
                <div class='card hvr-float' onclick='getId(this)' data-ownerOfAnimal='${card.owner}' data-objectId='${card._id}' data-price='${card.price}' data-animalName='${card.name}' data-rating='${card.rating.charAt(0)}' data-animalType='${card.type}'>
                    <div class='top-info'>
                        <div class='username'>
                            <h5>${card.owner}</h5>
                        </div>
                        <div class='rating'>
                            <h5>${card.rating}</h5>
                        </div>
                        </div>
                        <div class='card-img'>
                            <button class='favourite' type='button' name='button'> <a class='fa fa-heart' href='#'></a> </button>
                            <img src='${card.url}' alt=''>
                        </div>
                        <div class='bottom-info'>
                            <div class='title'>
                                <h4>${card.name}</h4>
                            </div>
                        <div class='price'>
                            <h5>$${card.price.toLocaleString()}</h5>
                            </div>
                        </div>
                </div>
            `},setupFilters=()=>{for(input of allFilterInputs)input.addEventListener("change",()=>{refreshElements();var e=""===typeInput.value,t=""===filterInput.value,o=""===searchInput.value;e||filterCards("byType",typeInput.value),t||filterCards("byFilter",filterInput.value),o||searchQuery(searchInput.value)});searchInput&&searchInput.addEventListener("keyup",()=>{searchQuery(searchInput.value)})},filterCards=(e,t)=>{refreshElements(),"byType"==e&&hideCardsThatArent(t),"byFilter"==e&&sortBy(t)},searchQuery=async e=>{for(title of titles)title.textContent.toLowerCase().includes(e.toLowerCase())?title.parentNode.parentNode.style.display="block":title.parentNode.parentNode.style.display="none"},sortBy=e=>{if(0==alreadyStored){for(var t=0;t<cards.length;t++)defaultSorted.push({element:cards[t]});alreadyStored=!0}switch(e){case"lowest":for(card of cards)pricesSorted.push({price:card.getAttribute("data-price"),element:card}),pricesSorted.sort((e,t)=>e.price-t.price);for(let e=0;e<pricesSorted.length;e++)cardParent.appendChild(pricesSorted[e].element);break;case"highest":for(card of cards)pricesSorted.push({price:card.getAttribute("data-price"),element:card}),pricesSorted.sort((e,t)=>t.price-e.price);for(let e=0;e<pricesSorted.length;e++)cardParent.appendChild(pricesSorted[e].element);break;case"viewed":for(card of cards)ratingsSorted.push({rating:card.getAttribute("data-rating"),element:card}),ratingsSorted.sort((e,t)=>t.rating-e.rating);for(let e=0;e<ratingsSorted.length;e++)cardParent.appendChild(ratingsSorted[e].element);break;case"none":for(let e=0;e<defaultSorted.length;e++)cardParent.appendChild(defaultSorted[e].element)}},hideCardsThatArent=e=>{for(card of cards){var t=e===card.getAttribute("data-animalType");t||(card.style.display="none"),t&&(card.style.display="block"),"all"===e&&(card.style.display="block")}},checkLoginValidity=async(...e)=>{var[t,o]=e;let n=await fetch(`/findUser?u=${t}&p=${o}`);e=await n.json();return n=""!=t&&""!=o,loggedIn&&loginHandler(),window.attemptedLogin=t,e},loginHandler=async()=>{if(refreshElements(),!loggedIn){if(await checkLoginValidity(usernameInput.value,passwordInput.value))return logInStyle(),currentSession=attemptedLogin,closeLoginButton.click(),console.log("Signing in"),loggedIn=!0,localStorage.setItem("currentSession",currentSession),void localStorage.setItem("loggedIn",loggedIn);createAlert("Incorrect login!"),closeLoginButton.click()}loggedIn&&(logOutStyle(),closeLoginButton.click(),console.log("Signing out"),loggedIn=!1,localStorage.setItem("currentSession",currentSession),localStorage.setItem("loggedIn",loggedIn))},createAccHandler=async()=>{var e,t;loggedIn||(e=usernameCreate.value,t=passwordCreate.value,console.log(e),console.log(t),""==e||""==t?createAlert("Please make sure all fields are filled out!"):await fetch("/createUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:"Click me to add your name!",username:e,phoneNo:"Click me to add a phone number!",email:"Click me to add a email!",description:"Click me to add a description!",password:t})}))},logInStyle=()=>{loginButton.textContent="Log Out",sessionHeader.textContent=`User: ${localStorage.getItem("currentSession")}`,usernameInput.style.display="none",passwordInput.style.display="none",createAccountButton.style.display="none"},logOutStyle=()=>{currentSession=null,loggedIn=!0,loginButton.textContent="Log In",sessionHeader.textContent="Log In",usernameInput.style.display="block",passwordInput.style.display="block",createAccountButton.style.display="block",loginPopOver.style.height="50vh",loginPopOver.style.paddingBottom="0"},updateCart=()=>{cartParent.innerHTML="",window.cartCost=[],localStorage.setItem("cartCost",JSON.stringify([]));for(item of cartList)cartCost.push(item.price),cartParent.innerHTML+=`
                <div class='cart-item' id='${item._id}' data-id='${item._id}'>
                    <div class='cart-item-img'>
                        <img class='cart-image' src='${item.url}' alt=''>
                    </div>
                <div class='cart-item-text'>
                    <h5 class='cart-item-title data-id='${item._id}''>${item.name}</h5>
                    <div class='cart-item-text-row'>
                        <h6 class='cart-item-price'>$${item.price.toLocaleString()}</h6>
                        <h6 class='cart-remove-btn' onclick='remove(this)' id='cartRemoveBtn'>Remove</h6>
                    </div>
                </div>
            </div>
        `;localStorage.setItem("cartCost",JSON.stringify(cartCost)),total.textContent=`Total: $${cartCost.reduce((e,t)=>e+t,0).toLocaleString()}`},removeFromArray=(e,t)=>{t=e.indexOf(t);return-1<t&&e.splice(t,1),e},remove=e=>{var t=e.parentNode.parentNode.parentNode.getAttribute("data-id");for(item of cartList)item._id==t&&(e.parentNode.parentNode.parentNode.remove(),removeFromArray(cartList,item),localStorage.setItem("cartItems",JSON.stringify(cartList)));updateCart()},removeFromPage=e=>{var t=e.parentNode.parentNode.parentNode.getAttribute("data-id");for(item of cartList)item._id==t&&(e.parentNode.parentNode.parentNode.parentNode.remove(),removeFromArray(cartList,item),localStorage.setItem("cartItems",JSON.stringify(cartList)));updateCart()};setInterval(function(){refreshElements(),"true"===localStorage.getItem("loggedIn")&&logInStyle(),"true"===localStorage.getItem("loggedIn")&&(loggedIn=!0),doneButton&&doneButton.addEventListener("click",async()=>{modalParent.remove(),enableScroll()})},500);let getId=e=>{localStorage.setItem("cardId",e.getAttribute("data-objectid")),localStorage.setItem("ownerOfAnimal",e.getAttribute("data-ownerOfAnimal")),window.location.href="/animalTemplate.html"},redirect=e=>{0==cartList.length?createAlert("Uh oh! Looks like your cart is empty! \n Looks like you need to go shopping :)"):window.location.href=e},setupEventListeners=()=>{loginButton.addEventListener("click",async()=>{loginHandler()}),mobileNavLogout.addEventListener("click",async()=>{loginHandler()}),myAccountBtn.addEventListener("click",()=>{1!=loggedIn?createAlert("Log in to view your account!"):window.location.href="/user.html"}),passwordCreate&&passwordCreate.addEventListener("keydown",e=>{13===e.keyCode&&(e.preventDefault(),loginButton.click())}),passwordInput.addEventListener("keydown",e=>{13===e.keyCode&&(e.preventDefault(),loginButton.click())}),signUpButton&&signUpButton.addEventListener("click",async()=>{createAccHandler()})},disableScroll=()=>{scrollTop=window.pageYOffset||document.documentElement.scrollTop,scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,window.onscroll=function(){window.scrollTo(scrollLeft,scrollTop)}},enableScroll=()=>{window.onscroll=function(){}},createAlert=e=>{document.querySelector(".modal-here").innerHTML+=`
        <div class='modal'>
          <h3>${e}</h3>
          <button type='button' class='button-secondary modalDone' name='button'>Done</button>
        </div>`,"block"==headerPopover.style.dispaly&&loginButton.click(),disableScroll()},startSwipeListeners=()=>{(async()=>{let t=0,o=0;document.querySelector(".responsive-nav");let e=document.querySelector(".header");e.addEventListener("touchstart",e=>{disableScroll(),t=e.changedTouches[0].screenY}),e.addEventListener("touchend",e=>{t=e.changedTouches[0].screenY,"user"==e.target.id||"cart"==e.target.id||t>o&&$(".responsive-nav").velocity({top:"0"},{duration:1e3,easing:"easeInOutQuint",delay:0})})})(),(async()=>{let t=0,o=0,e=document.querySelector(".responsive-nav");document.querySelector(".header");e.addEventListener("touchstart",e=>{t=e.changedTouches[0].screenY}),e.addEventListener("touchend",e=>{t=e.changedTouches[0].screenY,t>o&&$(".responsive-nav").velocity({top:"-100%"},{duration:1e3,easing:"easeInOutQuint",delay:0}),setTimeout(()=>{enableScroll()},1e3)})})()};"http://localhost:3000"==window.location.href&&handleHomeAnimals(),"http://localhost:3000/"==window.location.href&&handleHomeAnimals(),"http://localhost:3000/index.html"==window.location.href&&handleHomeAnimals(),"http://localhost:3000/index.html#listingSection"==window.location.href&&handleHomeAnimals(),startSwipeListeners(),refreshElements(),setupEventListeners(),setupFilters();